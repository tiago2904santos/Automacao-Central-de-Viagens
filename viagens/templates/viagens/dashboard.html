{% extends "viagens/base.html" %}
{% load static %}

{% block title %}Painel - Central de Viagens{% endblock %}

{% block breadcrumb %}
  Painel
{% endblock %}

{% block content %}
  <div class="page-header">
    <div>
      <h2 class="page-title">Painel de controle</h2>
      <p class="page-subtitle">Visao geral de oficios, roteiros e cadastros recentes.</p>
    </div>
  </div>

  <div class="dashboard" data-dashboard data-year="{{ year }}" data-endpoint="{% url 'dashboard_data_api' %}">
    <section class="kpi-grid" data-kpi-grid>
      <article class="kpi-card" data-kpi="oficios">
        <div class="kpi-head">
          <div class="kpi-title">Oficios</div>
          <i data-lucide="file-text" class="kpi-icon"></i>
        </div>
        <div class="kpi-value" data-kpi-value>{{ kpis.oficios.total }}</div>
        <div class="kpi-meta" data-kpi-meta>
          {{ kpis.oficios.periodo }} {{ kpis.oficios.rotulo_periodo }}
        </div>
        <div class="kpi-actions">
          <a class="btn-link" href="{% url 'oficios_lista' %}">Ver oficios</a>
          <a class="btn-clear btn-small" href="{% url 'formulario' %}">Novo oficio</a>
        </div>
      </article>

      <article class="kpi-card" data-kpi="veiculos">
        <div class="kpi-head">
          <div class="kpi-title">Veiculos</div>
          <i data-lucide="car" class="kpi-icon"></i>
        </div>
        <div class="kpi-value" data-kpi-value>{{ kpis.veiculos.total }}</div>
        <div class="kpi-meta" data-kpi-meta>
          {{ kpis.veiculos.periodo }} {{ kpis.veiculos.rotulo_periodo }}
        </div>
        <div class="kpi-actions">
          <a class="btn-link" href="{% url 'veiculos_lista' %}">Ver veiculos</a>
          <a class="btn-clear btn-small" href="{% url 'veiculo_cadastro' %}">Novo veiculo</a>
        </div>
      </article>

      <article class="kpi-card" data-kpi="viajantes">
        <div class="kpi-head">
          <div class="kpi-title">Viajantes</div>
          <i data-lucide="users" class="kpi-icon"></i>
        </div>
        <div class="kpi-value" data-kpi-value>{{ kpis.viajantes.total }}</div>
        <div class="kpi-meta" data-kpi-meta>
          {{ kpis.viajantes.periodo }} {{ kpis.viajantes.rotulo_periodo }}
        </div>
        <div class="kpi-actions">
          <a class="btn-link" href="{% url 'viajantes_lista' %}">Ver viajantes</a>
          <a class="btn-clear btn-small" href="{% url 'viajante_cadastro' %}">Novo viajante</a>
        </div>
      </article>
    </section>

    <section class="dashboard-grid">
      <article class="chart-card">
        <div class="chart-head">
          <h3>Oficios no ano</h3>
          <span class="chart-note" data-chart-note>{{ year }}</span>
        </div>
        <div class="chart" data-chart="oficios" aria-label="Grafico de oficios por dia"></div>
      </article>

      <article class="chart-card">
        <div class="chart-head">
          <h3>Ranking de viajantes</h3>
          <span class="chart-note" data-chart-note>mais viagens em {{ year }}</span>
        </div>
        <div class="chart" data-chart="ranking" aria-label="Grafico de ranking de viajantes"></div>
      </article>
    </section>
  </div>

  {{ initial_payload|json_script:"dashboard-initial" }}
{% endblock %}

{% block scripts %}
  <script src="{% static 'viagens/dashboard.js' %}"></script>
{% endblock %}
